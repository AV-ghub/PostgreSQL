# REPLICA IDENTITY
**REPLICA IDENTITY** –≤ PostgreSQL ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ WAL-–∂—É—Ä–Ω–∞–ª –¥–ª—è –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–∑–º–µ–Ω—è–µ–º–æ–π –∏–ª–∏ —É–¥–∞–ª—è–µ–º–æ–π —Å—Ç—Ä–æ–∫–∏ –ø—Ä–∏ –ª–æ–≥–∏—á–µ—Å–∫–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏–ª–∏ –ª–æ–≥–∏—á–µ—Å–∫–æ–º –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏. –û–Ω –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–µ–Ω –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–π `UPDATE` –∏ `DELETE`.

### üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ REPLICA IDENTITY –∏ –∑–∞—á–µ–º –æ–Ω–∞ –Ω—É–∂–Ω–∞

REPLICA IDENTITY –º–æ–∂–Ω–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–∞–∫ –∞–Ω–∞–ª–æ–≥ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `OLD` –≤ —Ç—Ä–∏–≥–≥–µ—Ä–∞—Ö. –ü—Ä–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ `UPDATE` –∏–ª–∏ `DELETE` –ø–æ–¥–ø–∏—Å—á–∏–∫ –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å, –∫–∞–∫—É—é –∏–º–µ–Ω–Ω–æ —Å—Ç—Ä–æ–∫—É –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å. –≠—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–æ–±—â–∞–µ—Ç PostgreSQL, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (—Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏) —Å–ª–µ–¥—É–µ—Ç –≤–∫–ª—é—á–∏—Ç—å –≤ WAL, —á—Ç–æ–±—ã –ø–æ–¥–ø–∏—Å—á–∏–∫ –º–æ–≥ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—É—é —Å—Ç—Ä–æ–∫—É –≤ —Å–≤–æ–µ–π –∫–æ–ø–∏–∏ —Ç–∞–±–ª–∏—Ü—ã.

–ë–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ REPLICA IDENTITY –æ–ø–µ—Ä–∞—Ü–∏–∏ `UPDATE` –∏ `DELETE` –Ω–∞ —Ç–∞–±–ª–∏—Ü–∞—Ö, –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö –≤ –ø—É–±–ª–∏–∫–∞—Ü–∏—é, –º–æ–≥—É—Ç –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è –æ—à–∏–±–∫–∞–º–∏.

### ‚öôÔ∏è –¢–∏–ø—ã REPLICA IDENTITY –∏ –∏—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

–°—É—â–µ—Å—Ç–≤—É–µ—Ç —á–µ—Ç—ã—Ä–µ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã REPLICA IDENTITY:

| –†–µ–∂–∏–º | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±–ª–∞—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è |
| :--- | :--- | :--- |
| **DEFAULT** | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á (PK), –∞ –ø—Ä–∏ –µ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ - –ª—é–±–æ–π –ø–æ–¥—Ö–æ–¥—è—â–∏–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å. –ï—Å–ª–∏ –Ω–µ—Ç –Ω–∏ —Ç–æ–≥–æ, –Ω–∏ –¥—Ä—É–≥–æ–≥–æ, —Ä–µ–∂–∏–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `NOTHING`. | **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–±–æ—Ä** –¥–ª—è —Ç–∞–±–ª–∏—Ü —Å –ø–µ—Ä–≤–∏—á–Ω—ã–º –∫–ª—é—á–æ–º. |
| **USING INDEX** | –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–æ–ª–±—Ü—ã —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏ –Ω–µ–Ω—É–ª–µ–≤–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞. | –î–ª—è —Ç–∞–±–ª–∏—Ü –±–µ–∑ PK, –Ω–æ —Å –¥—Ä—É–≥–∏–º–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. |
| **FULL** | –í WAL –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã —Å—Ç–∞—Ä–æ–π —Å—Ç—Ä–æ–∫–∏. | –î–ª—è —Ç–∞–±–ª–∏—Ü –±–µ–∑ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –∏ –±–µ–∑ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤, –∫–æ–≥–¥–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è `UPDATE`/`DELETE` –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞. |
| **NOTHING** | –ù–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ —Å—Ç–∞—Ä–æ–π —Å—Ç—Ä–æ–∫–µ –¥–ª—è `UPDATE` –∏ `DELETE`. | –î–ª—è —Ç–∞–±–ª–∏—Ü, –≥–¥–µ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π `UPDATE` –∏ `DELETE` –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–±–ª–∏—Ü—ã –ª–æ–≥–æ–≤). |

**–ö–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å REPLICA IDENTITY**

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü—ã –º–æ–∂–Ω–æ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã `ALTER TABLE`:
```sql
ALTER TABLE –∏–º—è_—Ç–∞–±–ª–∏—Ü—ã REPLICA IDENTITY { DEFAULT | USING INDEX –∏–º—è_–∏–Ω–¥–µ–∫—Å–∞ | FULL | NOTHING };
```

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É**

–ß—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Ç–µ–∫—É—â–∏–π REPLICA IDENTITY –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å:
```sql
SELECT relname, 
       CASE relreplident 
         WHEN 'd' THEN 'default' 
         WHEN 'n' THEN 'nothing' 
         WHEN 'f' THEN 'full' 
         WHEN 'i' THEN 'index' 
       END AS replica_identity
FROM pg_class 
WHERE relname = '–∏–º—è_–≤–∞—à–µ–π_—Ç–∞–±–ª–∏—Ü—ã';
```

### üí° –û–±–ª–∞—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- **–õ–æ–≥–∏—á–µ—Å–∫–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è**: –ë–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ REPLICA IDENTITY (–Ω–µ `NOTHING`) –æ–ø–µ—Ä–∞—Ü–∏–∏ `UPDATE` –∏ `DELETE` –Ω–∞ –∏–∑–¥–∞—Ç–µ–ª–µ –Ω–µ —Å–º–æ–≥—É—Ç –Ω–∞–π—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ –ø–æ–¥–ø–∏—Å—á–∏–∫–µ.
- **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã CDC**: –¢–∞–∫–∏–µ —Å–∏—Å—Ç–µ–º—ã, –∫–∞–∫ **Debezium**, –ø–æ–ª–∞–≥–∞—é—Ç—Å—è –Ω–∞ –¥–∞–Ω–Ω—ã–µ –∏–∑ WAL. –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ TOAST-—Å—Ç–æ–ª–±—Ü–æ–≤ (–±–æ–ª—å—à–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π) –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —Ä–µ–∂–∏–º `FULL`.
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –†–µ–∂–∏–º `FULL` —Å–æ–∑–¥–∞–µ—Ç –Ω–∞–∏–±–æ–ª—å—à—É—é –Ω–∞–≥—Ä—É–∑–∫—É, —Ç–∞–∫ –∫–∞–∫ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ WAL –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö. –í PostgreSQL 16 —ç—Ç–∞ –Ω–∞–≥—Ä—É–∑–∫–∞ —Å–Ω–∏–∂–µ–Ω–∞ –∑–∞ —Å—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞.

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
*   –î–ª—è —Ç–∞–±–ª–∏—Ü —Å –ø–µ—Ä–≤–∏—á–Ω—ã–º –∫–ª—é—á–æ–º –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ–∂–∏–º–∞ **`DEFAULT`**.
*   –†–µ–∂–∏–º **`FULL`** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è —Ç–∞–±–ª–∏—Ü –±–µ–∑ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞, –Ω–æ –ø–æ–º–Ω–∏—Ç–µ –æ –Ω–∞–≥—Ä—É–∑–∫–µ.
*   –ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω—ã —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤—Å–µ—Ö —Å—Ç–æ–ª–±—Ü–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –∞—É–¥–∏—Ç–∞ –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ TOAST-–¥–∞–Ω–Ω—ã—Ö), –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å **`FULL`**, –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –æ—Ü–µ–Ω–∏–≤ –Ω–∞–≥—Ä—É–∑–∫—É.
*   –î–ª—è –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ) –ø–æ–¥–æ–π–¥–µ—Ç **`NOTHING`**.

