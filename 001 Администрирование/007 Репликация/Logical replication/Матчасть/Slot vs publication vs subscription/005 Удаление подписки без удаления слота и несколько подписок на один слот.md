## üîÑ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ–ª—å–∫–æ –ø–æ–¥–ø–∏—Å–∫–∏ (–±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è —Å–ª–æ—Ç–∞):

### **–°—Ü–µ–Ω–∞—Ä–∏–π 1: –£–¥–∞–ª–∏–ª–∏ –ø–æ–¥–ø–∏—Å–∫—É, —Å–ª–æ—Ç –æ—Å—Ç–∞–ª—Å—è**
```sql
-- –ù–∞ –ø–æ–¥–ø–∏—Å—á–∏–∫–µ:
DROP SUBSCRIPTION problem_subscription;

-- –ù–∞ –∏–∑–¥–∞—Ç–µ–ª–µ —Å–ª–æ—Ç –û–°–¢–ê–õ–°–Ø:
SELECT slot_name, active, database FROM pg_replication_slots;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚ùå –ü–†–û–ë–õ–ï–ú–ê –ù–ï –†–ï–®–ê–ï–¢–°–Ø!**

–ü–æ—á–µ–º—É:
1. –°–ª–æ—Ç **–ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å** –≤ `pg_replication_slots`
2. PostgreSQL **–ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å WAL** –¥–ª—è —ç—Ç–æ–≥–æ —Å–ª–æ—Ç–∞
3. –û—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ **–ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞—Å—Ç–∏** (—Ç–µ–ø–µ—Ä—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è –Ω–µ—Ç)

### **–°—Ü–µ–Ω–∞—Ä–∏–π 2: –£–¥–∞–ª–∏–ª–∏ –ø–æ–¥–ø–∏—Å–∫—É –ò —Å–ª–æ—Ç**
```sql
-- 1. –°–Ω–∞—á–∞–ª–∞ –Ω–∞ –ø–æ–¥–ø–∏—Å—á–∏–∫–µ
DROP SUBSCRIPTION problem_subscription;

-- 2. –ü–æ—Ç–æ–º –Ω–∞ –∏–∑–¥–∞—Ç–µ–ª–µ (–µ—Å–ª–∏ —Å–ª–æ—Ç –Ω–µ —É–¥–∞–ª–∏–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
SELECT pg_drop_replication_slot('slot_name');
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ê–ï–¢–°–Ø!**

## üìå –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–∞—à–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã:

### ‚ùì "–ú–æ–∂–Ω–æ –ª–∏ —á–µ—Ä–µ–∑ –æ–¥–∏–Ω —Å–ª–æ—Ç —Å–¥–µ–ª–∞—Ç—å 2-3 –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Ä–∞–∑–Ω—ã–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏?"
**–ù–ï–¢, —ç—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ!** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ PostgreSQL –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ç–æ:

```sql
-- –ù–ï –†–ê–ë–û–¢–ê–ï–¢: –æ–¥–∏–Ω —Å–ª–æ—Ç = –æ–¥–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞
CREATE SUBSCRIPTION sub1 
CONNECTION '...' 
PUBLICATION pub1 
WITH (slot_name = 'common_slot');

CREATE SUBSCRIPTION sub2  -- –û–®–ò–ë–ö–ê! –°–ª–æ—Ç —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
CONNECTION '...' 
PUBLICATION pub2 
WITH (slot_name = 'common_slot');
```

**–ö–∞–∂–¥–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞—ë—Ç —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å–ª–æ—Ç.**

### ‚ùì "–ï—Å–ª–∏ —É–¥–∞–ª–∏—Ç—å –æ—Ç—Å—Ç–∞—é—â—É—é –ø–æ–¥–ø–∏—Å–∫—É, –≤—Å—ë –Ω–∞–ª–∞–¥–∏—Ç—Å—è?"
**–¢–û–õ–¨–ö–û –µ—Å–ª–∏ —Å–ª–æ—Ç —É–¥–∞–ª–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**, –Ω–æ —Ç–∞–∫ –±—ã–≤–∞–µ—Ç –Ω–µ –≤—Å–µ–≥–¥–∞:

```sql
-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ DROP SUBSCRIPTION:
SELECT slot_name, active 
FROM pg_replication_slots 
WHERE slot_name = 'slot_from_dropped_sub';

-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
-- 1. –í 90% —Å–ª—É—á–∞–µ–≤ —Å–ª–æ—Ç —É–¥–∞–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚úÖ
-- 2. –í 10% —Å–ª—É—á–∞–µ–≤ —Å–ª–æ—Ç –æ—Å—Ç–∞—ë—Ç—Å—è (–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ —Å–±–æ—è—Ö) ‚ùå
```

### ‚ùì "–ü—Ä–∏–¥—ë—Ç—Å—è —É–¥–∞–ª—è—Ç—å –≤—Å–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏?"
**–ù–ï–¢, –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–µ –∏–º–µ—é—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫ –ø—Ä–æ–±–ª–µ–º–µ!**

–ü—É–±–ª–∏–∫–∞—Ü–∏–∏ ‚â† –°–ª–æ—Ç—ã:
- **–ü—É–±–ª–∏–∫–∞—Ü–∏—è** ‚Äî –ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ (–±–µ–∑–æ–ø–∞—Å–Ω–∞)
- **–°–ª–æ—Ç** ‚Äî –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å WAL (–æ–ø–∞—Å–µ–Ω –ø—Ä–∏ –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–∏)

```sql
-- –£–¥–∞–ª–µ–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ù–ï –ø–æ–º–æ–∂–µ—Ç:
DROP PUBLICATION some_publication;  -- WAL –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å—Å—è!

-- –ù—É–∂–Ω–æ —É–¥–∞–ª—è—Ç—å –∏–º–µ–Ω–Ω–æ –°–õ–û–¢:
SELECT pg_drop_replication_slot('problem_slot');  -- WAL –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è
```

## üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø—Ä–∏ –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–∏:

### –®–∞–≥ 1: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```sql
-- –ù–∞ –∏–∑–¥–∞—Ç–µ–ª–µ —Å–º–æ—Ç—Ä–∏–º –≤—Å–µ —Å–ª–æ—Ç—ã
SELECT 
    slot_name,
    active,
    pg_size_pretty(
        pg_wal_lsn_diff(pg_current_wal_lsn(), restart_lsn)
    ) as lag_size,
    pg_size_pretty(
        pg_wal_lsn_diff(pg_current_wal_lsn(), confirmed_flush_lsn)
    ) as confirmed_lag
FROM pg_replication_slots;
```

### –®–∞–≥ 2: –†–µ—à–µ–Ω–∏–µ (–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç)

**–í–∞—Ä–∏–∞–Ω—Ç A: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è** (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤–∞—à Flink/CDC –ø—Ä–æ—Ü–µ—Å—Å
systemctl restart flink-cdc
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –£–¥–∞–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ò —Å–ª–æ—Ç**
```sql
-- 1. –ù–∞ –ø–æ–¥–ø–∏—Å—á–∏–∫–µ
DROP SUBSCRIPTION problem_sub;

-- 2. –ù–∞ –∏–∑–¥–∞—Ç–µ–ª–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º
SELECT slot_name FROM pg_replication_slots 
WHERE slot_name LIKE '%problem_sub%';

-- 3. –ï—Å–ª–∏ —Å–ª–æ—Ç –æ—Å—Ç–∞–ª—Å—è, —É–¥–∞–ª—è–µ–º –≤—Ä—É—á–Ω—É—é
SELECT pg_drop_replication_slot('problem_sub_slot');
```

**–í–∞—Ä–∏–∞–Ω—Ç C: –¢–æ–ª—å–∫–æ —É–¥–∞–ª–∏—Ç—å —Å–ª–æ—Ç** (—ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π)
```sql
-- –ü—Ä—è–º–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–ª–æ—Ç–∞ (–ø–æ–¥–ø–∏—Å–∫–∞ —Å–ª–æ–º–∞–µ—Ç—Å—è)
SELECT pg_drop_replication_slot('problem_slot');
-- –ü–æ–¥–ø–∏—Å–∫–∞ —Å—Ç–∞–Ω–µ—Ç –Ω–µ—Ä–∞–±–æ—á–µ–π, –µ—ë —Ç–æ–∂–µ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —É–¥–∞–ª–∏—Ç—å
```

### –®–∞–≥ 3: –û—á–∏—Å—Ç–∫–∞ WAL
```sql
-- –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —Å–ª–æ—Ç–∞ —É—Å–∫–æ—Ä—å—Ç–µ cleanup
SELECT pg_switch_wal();
CHECKPOINT;
```

## üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–µ–π—Å—Ç–≤–∏–π:

| –î–µ–π—Å—Ç–≤–∏–µ | –£–¥–∞–ª–∏—Ç —Å–ª–æ—Ç? | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ WAL? | –ü–æ–¥–ø–∏—Å–∫–∞ |
|----------|--------------|---------------------------|----------|
| `DROP SUBSCRIPTION` | **–ò–Ω–æ–≥–¥–∞** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏) | –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–ª–æ—Ç —É–¥–∞–ª–∏–ª—Å—è | ‚ùå –£–¥–∞–ª–µ–Ω–∞ |
| `pg_drop_replication_slot()` | **–í—Å–µ–≥–¥–∞** | ‚úÖ –î–∞, —Å—Ä–∞–∑—É | ‚ùå –°–ª–æ–º–∞–Ω–∞ |
| `ALTER SUBSCRIPTION ... DISABLE` | –ù–µ—Ç | ‚ùå –ù–µ—Ç | ‚è∏Ô∏è –û—Ç–∫–ª—é—á–µ–Ω–∞ |
| `DROP PUBLICATION` | –ù–µ—Ç | ‚ùå –ù–µ—Ç | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |

## üí° –ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ:

**"–û–¥–∏–Ω —Å–ª–æ—Ç ‚Äî –æ–¥–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞ ‚Äî –æ–¥–Ω–∞ —Ç–æ—á–∫–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è WAL"**

–ï—Å–ª–∏ –Ω–∞—á–∞–ª–æ—Å—å –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ –∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
1. **–£–¥–∞–ª–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É** (`DROP SUBSCRIPTION`)
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —É–¥–∞–ª–∏–ª—Å—è –ª–∏ —Å–ª–æ—Ç** 
3. **–ï—Å–ª–∏ –Ω–µ—Ç ‚Äî —É–¥–∞–ª–∏—Ç–µ —Å–ª–æ—Ç –≤—Ä—É—á–Ω—É—é** (`pg_drop_replication_slot`)
4. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Å—Ç–∞–≤–ª—è–π—Ç–µ "–≤–∏—Å—è—á–∏–µ" —Å–ª–æ—Ç—ã!**

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç —Ä–æ—Å—Ç WAL –∏ –æ—Å–≤–æ–±–æ–¥–∏—Ç –¥–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ.
