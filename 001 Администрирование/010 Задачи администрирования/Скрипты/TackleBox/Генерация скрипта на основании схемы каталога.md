–ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ —Å–æ–∑–¥–∞—Ç—å –æ–±—â–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –í–æ—Ç –Ω–∞–∏–±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã:

## üîß –°–ø–æ—Å–æ–± 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL —á–µ—Ä–µ–∑ –∑–∞–ø—Ä–æ—Å

```sql
SELECT 'ALTER TABLE ' || 
       quote_ident(table_schema) || '.' || 
       quote_ident(table_name) || 
       ' REPLICA IDENTITY FULL;' as sql_command
FROM information_schema.tables
WHERE table_schema NOT IN ('pg_catalog', 'information_schema')
  AND table_type = 'BASE TABLE'
ORDER BY table_schema, table_name;
```

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç–µ–∫—É—â–µ–≥–æ REPLICA IDENTITY:

```sql
SELECT 
    'ALTER TABLE ' || 
    quote_ident(n.nspname) || '.' || 
    quote_ident(c.relname) || 
    ' REPLICA IDENTITY FULL;' as sql_command,
    CASE c.relreplident 
        WHEN 'd' THEN 'DEFAULT'
        WHEN 'n' THEN 'NOTHING' 
        WHEN 'f' THEN 'FULL'
        WHEN 'i' THEN 'INDEX'
    END as current_setting
FROM pg_class c
JOIN pg_namespace n ON n.oid = c.relnamespace
WHERE c.relkind = 'r'  -- –æ–±—ã—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
  AND n.nspname NOT IN ('pg_catalog', 'information_schema')
  AND c.relreplident != 'f'  -- –∏—Å–∫–ª—é—á–∞–µ–º —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ FULL
ORDER BY n.nspname, c.relname;
```

## üìù –°–ø–æ—Å–æ–± 2: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –≤ —Ñ–∞–π–ª

### –ß–µ—Ä–µ–∑ psql —Å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –≤—ã–≤–æ–¥–∞:
```bash
psql -d –≤–∞—à–∞_–±–∞–∑–∞ -c "
SELECT 'ALTER TABLE ' || 
       quote_ident(table_schema) || '.' || 
       quote_ident(table_name) || 
       ' REPLICA IDENTITY FULL;'
FROM information_schema.tables
WHERE table_schema NOT IN ('pg_catalog', 'information_schema')
  AND table_type = 'BASE TABLE'
ORDER BY table_schema, table_name;
" -t -A > alter_tables.sql
```

### –ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç:
```bash
psql -d –≤–∞—à–∞_–±–∞–∑–∞ -f alter_tables.sql
```

## ‚ö° –°–ø–æ—Å–æ–± 3: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ DO –±–ª–æ–∫ (–±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Ñ–∞–π–ª–∞)

```sql
DO $$
DECLARE
    tbl record;
BEGIN
    FOR tbl IN 
        SELECT n.nspname as schema_name, c.relname as table_name
        FROM pg_class c
        JOIN pg_namespace n ON n.oid = c.relnamespace
        WHERE c.relkind = 'r'
          AND n.nspname NOT IN ('pg_catalog', 'information_schema')
          AND c.relreplident != 'f'
        ORDER BY n.nspname, c.relname
    LOOP
        EXECUTE 'ALTER TABLE ' || 
                quote_ident(tbl.schema_name) || '.' || 
                quote_ident(tbl.table_name) || 
                ' REPLICA IDENTITY FULL;';
        RAISE NOTICE '–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞: %.%', tbl.schema_name, tbl.table_name;
    END LOOP;
END $$;
```

## üõ°Ô∏è –°–ø–æ—Å–æ–± 4: –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏ (–¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü)

```sql
DO $$
DECLARE
    tbl record;
    sql_command text;
BEGIN
    FOR tbl IN 
        SELECT n.nspname as schema_name, c.relname as table_name
        FROM pg_class c
        JOIN pg_namespace n ON n.oid = c.relnamespace
        WHERE c.relkind = 'r'
          AND n.nspname NOT IN ('pg_catalog', 'information_schema')
          AND c.relreplident != 'f'
          AND n.nspname = 'dbo'  -- —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ö–µ–º—ã dbo
        ORDER BY pg_relation_size(c.oid) DESC  -- –Ω–∞—á–∏–Ω–∞–µ–º —Å –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü
    LOOP
        sql_command := 'ALTER TABLE ' || 
                      quote_ident(tbl.schema_name) || '.' || 
                      quote_ident(tbl.table_name) || 
                      ' REPLICA IDENTITY FULL;';
        
        BEGIN
            EXECUTE sql_command;
            RAISE NOTICE '‚úì –£—Å–ø–µ—à–Ω–æ: %.%', tbl.schema_name, tbl.table_name;
        EXCEPTION WHEN OTHERS THEN
            RAISE WARNING '‚úó –û—à–∏–±–∫–∞ –¥–ª—è %.%: %', 
                tbl.schema_name, tbl.table_name, SQLERRM;
        END;
    END LOOP;
END $$;
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ REPLICA IDENTITY

–ü–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:

```sql
SELECT 
    n.nspname as schema_name,
    c.relname as table_name,
    CASE c.relreplident 
        WHEN 'd' THEN 'DEFAULT (uses primary key)'
        WHEN 'n' THEN 'NOTHING (no replication of UPDATE/DELETE)'
        WHEN 'f' THEN 'FULL (already set)'
        WHEN 'i' THEN 'USING INDEX (named index)'
    END as replica_identity,
    pg_size_pretty(pg_total_relation_size(c.oid)) as table_size
FROM pg_class c
JOIN pg_namespace n ON n.oid = c.relnamespace
WHERE c.relkind = 'r'
  AND n.nspname NOT IN ('pg_catalog', 'information_schema')
ORDER BY n.nspname, c.relname;
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

1. **REPLICA IDENTITY FULL —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç WAL** ‚Äî –¥–ª—è –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ UPDATE/DELETE –≤ WAL –±—É–¥—É—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –í–°–ï —Å—Ç–æ–ª–±—Ü—ã —Å—Ç–∞—Ä–æ–π —Å—Ç—Ä–æ–∫–∏
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π** ‚Äî –µ—Å–ª–∏ —É —Ç–∞–±–ª–∏—Ü—ã –µ—Å—Ç—å PK, –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `DEFAULT`:
   ```sql
   -- –¢–æ–ª—å–∫–æ –¥–ª—è —Ç–∞–±–ª–∏—Ü –±–µ–∑ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
   SELECT 'ALTER TABLE ' || 
          quote_ident(table_schema) || '.' || 
          quote_ident(table_name) || 
          ' REPLICA IDENTITY FULL;'
   FROM information_schema.tables t
   WHERE table_schema NOT IN ('pg_catalog', 'information_schema')
     AND table_type = 'BASE TABLE'
     AND NOT EXISTS (
         SELECT 1 
         FROM information_schema.table_constraints tc
         WHERE tc.table_schema = t.table_schema
           AND tc.table_name = t.table_name
           AND tc.constraint_type = 'PRIMARY KEY'
     );
   ```

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ REPLICA IDENTITY —Ç—Ä–µ–±—É–µ—Ç —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

–ï—Å–ª–∏ —É –≤–∞—Å –º–Ω–æ–≥–æ —Ç–∞–±–ª–∏—Ü, –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–°–ø–æ—Å–æ–± 3 (DO –±–ª–æ–∫)** ‚Äî –æ–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –ø–æ–∫–∞–∂–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å.

–î–ª—è —Ç–∞–±–ª–∏—Ü —Å –ø–µ—Ä–≤–∏—á–Ω—ã–º –∫–ª—é—á–æ–º –ª—É—á—à–µ –æ—Å—Ç–∞–≤–∏—Ç—å `REPLICA IDENTITY DEFAULT`, –∞ FULL —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–∞–±–ª–∏—Ü –±–µ–∑ PK.
